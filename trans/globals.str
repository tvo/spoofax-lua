module globals

imports
  include/Lua
  rename

strategies

  globals-top = alltd(globals)

  globals:
    Assignment(var*, exp*) -> <id>
    where
      <all(try(
        ?d@Var(x{});
        not(<GlobalVar> x);
        rules( GlobalVar : x -> d )
      ))> var*;
      <globals-top> exp*

  globals:
    Var(x{}) -> <id>
    where
      rules( VarUse : x -> x )
